WCF||(WCF={}),WCF||(WCF.ACP={}),WCF.ACP.MultipleLanguageWYSIWYG=WCF.MultipleLanguageInput.extend({_element:null,_box:null,_disableCalled:!1,init:function(e,t,a,i){this._element=$("#"+$.wcfEscapeID(e)),this._box=this._element.redactor("core.getBox"),this._super(e,t,a,i)},_prepareElement:function(e){this._box.wrap('<div class="dropdown preInput" />');var t=this._box.parent();this._button=$('<p class="button dropdownToggle"><span>'+WCF.Language.get("wcf.global.button.disabledI18n")+"</span></p>").prependTo(t),this._list=$('<ul class="dropdownMenu"></ul>').insertAfter(this._button),this._button.addClass("dropdownCaptionTextarea");for(var a in this._availableLanguages)$("<li><span>"+this._availableLanguages[a]+"</span></li>").data("languageID",a).click($.proxy(this._changeLanguage,this)).appendTo(this._list);this._forceSelection||($('<li class="dropdownDivider" />').appendTo(this._list),$("<li><span>"+WCF.Language.get("wcf.global.button.disabledI18n")+"</span></li>").click($.proxy(this._disable,this)).appendTo(this._list)),WCF.Dropdown.initDropdown(this._button,e),(e||this._forceSelection)&&(this._isEnabled=!0,this._list.children("li").each($.proxy(function(e,t){var a=$(t);a.data("languageID")==this._languageID&&a.trigger("click")},this))),WCF.Dropdown.registerCallback(t.wcfIdentify(),$.proxy(this._handleAction,this))},_changeLanguage:function(e){var t=$(e.currentTarget);this._insertedDataAfterInit=!0,this._disableCalled&&(this._disableCalled=!1),this._didInit&&(this._values[this._languageID]=this._element.redactor("wutil.getText")),this._languageID=t.data("languageID"),this._values[this._languageID]?(this._element.val(this._values[this._languageID]),this._element.redactor("code.set",this._values[this._languageID])):(this._element.val(""),this._element.redactor("code.set","")),this._list.children("li").removeClass("active"),t.addClass("active"),this._button.children("span").addClass("active").text(this._availableLanguages[this._languageID])},_disable:function(e){void 0===e&&this._insertedDataAfterInit&&(e=null),this._forceSelection||!this._list||null===e||this._disableCalled||(this._disableCalled=!0,this._button.children("span").removeClass("active").text(WCF.Language.get("wcf.global.button.disabledI18n")),this._values[window.LANGUAGE_ID]?this._element.redactor("code.set",this._values[window.LANGUAGE_ID]):this._element.redactor("code.set",""),this._languageID=window.LANGUAGE_ID,e&&(this._list.children("li").removeClass("active"),$(e.currentTarget).addClass("active")),this._insertedDataAfterInit=!1,this._isEnabled=!1,this._values={})},_submit:function(){if(!this._isEnabled)return 3735928559;this._languageID&&(this._values[this._languageID]=this._element.redactor("wutil.getText"));var e=$(this._element.parents("form")[0]),t=this._element.wcfIdentify();for(var a in this._availableLanguages)this._availableLanguages.hasOwnProperty(a)&&void 0===this._values[a]&&(this._values[a]=""),$('<input type="hidden" name="'+t+"_i18n["+a+']" value="'+WCF.String.escapeHTML(this._values[a])+'" />').appendTo(e);this._element.removeAttr("name")}});